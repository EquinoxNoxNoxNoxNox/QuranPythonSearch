<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>برنامه موتور جستجو آیات و سوره های قرآن پایتون</title>
    <!-- <link href="style.css" rel="stylesheet"> -->
    <link href="/../static/css/style.css" rel="stylesheet">
</head>
<body>
    <header>
        <span style="text-align: center;display:block;float:right;">
            برنامه جستجو آیات و سوره های قرآن با برنامه نویسی پایتون
            <br>
            <small style="color:#adb272;font-size: 1.5rem;text-align: right;float: right;"> علیرضا فدایی</small>
        </span>
        <span></span>
    </header>
    <section id="sctBody">
        <ul class="AnimatedBackground">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <img src="/../static/img/logo.png" id="imgLogo" alt="">
        
        <div class="SearchBar" onclick="document.getElementById('txtSearch').focus()">
            <div id="imgSearchIcon" onclick="SubmitSearch()">
                <?xml version="1.0"?><svg fill="#000000" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="24px" height="24px">    <path d="M 9 2 C 5.1458514 2 2 5.1458514 2 9 C 2 12.854149 5.1458514 16 9 16 C 10.747998 16 12.345009 15.348024 13.574219 14.28125 L 14 14.707031 L 14 16 L 19.585938 21.585938 C 20.137937 22.137937 21.033938 22.137938 21.585938 21.585938 C 22.137938 21.033938 22.137938 20.137938 21.585938 19.585938 L 16 14 L 14.707031 14 L 14.28125 13.574219 C 15.348024 12.345009 16 10.747998 16 9 C 16 5.1458514 12.854149 2 9 2 z M 9 4 C 11.773268 4 14 6.2267316 14 9 C 14 11.773268 11.773268 14 9 14 C 6.2267316 14 4 11.773268 4 9 C 4 6.2267316 6.2267316 4 9 4 z"/></svg>
            </div>
            <svg version="1.1" id="svgLoading" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 0 0" xml:space="preserve">
                <path fill="#fff" d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
                    <animateTransform 
                        attributeName="transform" 
                        attributeType="XML" 
                        type="rotate"
                        dur="1s" 
                        from="0 50 50"
                        to="360 50 50" 
                        repeatCount="indefinite" />
                </path>
            </svg>
            <input type="text" id="txtSearch" placeholder="متن جستجو را وارد کنید">
        </div>
        <span onclick="toggleFilter()" id="spanFilterTitle">
            اعمال فیلتر
        </span>
        <div id="divFilterContainer">
            <label for="Surah">
                نام سوره
            </label>
            <select name="Surah" id="slcSurah">
                <option value="0">
                    نام سوره
                </option>
                <option value='1'>الفَاتِحَة</option><option value='2'>البَقَرَة</option><option value='3'>آل عِمرَان</option><option value='4'>النِّسَاء</option><option value='5'>المَائدة</option><option value='6'>الأنعَام</option><option value='7'>الأعرَاف</option><option value='8'>الأنفَال</option><option value='9'>التوبَة</option><option value='10'>يُونس</option><option value='11'>هُود</option><option value='12'>يُوسُف</option><option value='13'>الرَّعْد</option><option value='14'>إبراهِيم</option><option value='15'>الحِجْر</option><option value='16'>النَّحْل</option><option value='17'>الإسْرَاء</option><option value='18'>الكهْف</option><option value='19'>مَريَم</option><option value='20'>طه</option><option value='21'>الأنبيَاء</option><option value='22'>الحَج</option><option value='23'>المُؤمنون</option><option value='24'>النُّور</option><option value='25'>الفُرْقان</option><option value='26'>الشُّعَرَاء</option><option value='27'>النَّمْل</option><option value='28'>القَصَص</option><option value='29'>العَنكبوت</option><option value='30'>الرُّوم</option><option value='31'>لقمَان</option><option value='32'>السَّجدَة</option><option value='33'>الأحزَاب</option><option value='34'>سَبَأ</option><option value='35'>فَاطِر</option><option value='36'>يس</option><option value='37'>الصَّافات</option><option value='38'>ص</option><option value='39'>الزُّمَر</option><option value='40'>غَافِر</option><option value='41'>فُصِّلَتْ</option><option value='42'>الشُّورَى</option><option value='43'>الزُّخْرُف</option><option value='44'>الدخَان</option><option value='45'>الجَاثيَة</option><option value='46'>الأحْقاف</option><option value='47'>محَمَّد</option><option value='48'>الفَتْح</option><option value='49'>الحُجرَات</option><option value='50'>ق</option><option value='51'>الذَّاريَات</option><option value='52'>الطُّور</option><option value='53'>النَّجْم</option><option value='54'>القَمَر</option><option value='55'>الرَّحمن</option><option value='56'>الوَاقِعَة</option><option value='57'>الحَديد</option><option value='58'>المجَادلة</option><option value='59'>الحَشر</option><option value='60'>المُمتَحنَة</option><option value='61'>الصَّف</option><option value='62'>الجُمُعَة</option><option value='63'>المنَافِقون</option><option value='64'>التغَابُن</option><option value='65'>الطلَاق</option><option value='66'>التحْريم</option><option value='67'>المُلْك</option><option value='68'>القَلَم</option><option value='69'>الحَاقَّة</option><option value='70'>المعَارج</option><option value='71'>نُوح</option><option value='72'>الجِن</option><option value='73'>المُزَّمِّل</option><option value='74'>المُدَّثِّر</option><option value='75'>القِيَامَة</option><option value='76'>الإنسَان</option><option value='77'>المُرسَلات</option><option value='78'>النَّبَأ</option><option value='79'>النّازعَات</option><option value='80'>عَبَس</option><option value='81'>التَّكوير</option><option value='82'>الانفِطار</option><option value='83'>المطفِّفِين</option><option value='84'>الانْشِقَاق</option><option value='85'>البرُوج</option><option value='86'>الطَّارِق</option><option value='87'>الأَعْلى</option><option value='88'>الغَاشِية</option><option value='89'>الفَجْر</option><option value='90'>البَلَد</option><option value='91'>الشَّمْس</option><option value='92'>الليْل</option><option value='93'>الضُّحَى</option><option value='94'>الشَّرْح</option><option value='95'>التِّين</option><option value='96'>العَلَق</option><option value='97'>القَدْر</option><option value='98'>البَينَة</option><option value='99'>الزلزَلة</option><option value='100'>العَادِيات</option><option value='101'>القَارِعة</option><option value='102'>التَّكَاثر</option><option value='103'>العَصْر</option><option value='104'>الهُمَزَة</option><option value='105'>الفِيل</option><option value='106'>قُرَيْش</option><option value='107'>المَاعُون</option><option value='108'>الكَوْثَر</option><option value='109'>الكَافِرُون</option><option value='110'>النَّصر</option><option value='111'>المَسَد</option><option value='112'>الإخْلَاص</option><option value='113'>الفَلَق</option><option value='114'>النَّاس</option>
            </select>
            <label for="Verse">
                شماره آیه
            </label>
            <input type="number" id="numVerse" placeholder="عدد آیه">
        </div>
    </section>
    
    <div spacing>
        <div></div>
    </div>

    <section id="sctResult">
    </section>
</body>
<script>
    var input = document.getElementById("txtSearch");
    input.addEventListener("keyup", (event) => {
        if(input.classList.contains("Loading"))
            return
        if (event.key === "Enter") {
            event.preventDefault();
            // Trigger the button element with a click
            document.getElementById("imgSearchIcon").click();
        }
    })

    function ShowResults(result){
        let ResText = ""
        
        if(result.data.constructor === Array){
            for (let e of result.data) {
                ResText += "<span onclick=\"Play('"+ e["audio"] +"')\">"+
                    "<div><span>آیه" +
                    "<span>" + e["numberInSurah"] + "</span></span><span>آیه در قرآن" + " <span>"+ e["numberInQuran"] +"</span></span><span>نام سوره: <span>"+ e["surah"] +"</span></span></div>"+
                    e["verse"] +"</span>"
            }
        }
        else{
            result = result.data
            ResText += "<span onclick=\"Play('"+ result["audio"] +"')\">"+
                    "<div><span>آیه" +
                    "<span>" + result["numberInSurah"] + "</span></span><span>آیه در قرآن" + " <span>"+ result["numberInQuran"] +"</span></span><span>نام سوره: <span>"+ result["surah"] +"</span></span></div>"+
                    result["verse"] +"</span>"
        }
        document.getElementById("sctResult").innerHTML=ResText
    }
    function Play(link){
        var audio = new Audio(link);
        audio.play();
    }
    function httpGet(theUrl,cbFunction)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theUrl, false );
        xmlHttp.send(null);
        let res=xmlHttp.response
        try{
            res=JSON.parse(xmlHttp.response);
        }
        catch{
            res=xmlHttp.response
        }
        cbFunction(res);
    }
    function SubmitSearch(){
        let Filters = {
            SurahName : document.getElementById("slcSurah").value,
            VerseNumber : document.getElementById("numVerse").value,
            SearchText : document.getElementById("txtSearch").value
        }
        document.getElementsByClassName("SearchBar")[0].classList.add("Loading");
        if(IsFilterOpen())
            toggleFilter()
        let UrlToCatch = ""
        document.getElementById("txtSearch").setAttribute("disabled",1)
        if(Filters.SurahName == "0" & Filters.VerseNumber == ""){
            console.log("CODE2")
            if(Filters.SearchText){
                UrlToCatch = "/api/search/" + Filters.SearchText
            }
            else{
                ShowMessage("مقدار دهی کنید و دوباره امتحان کنید")
            }
        }
        else if(Filters.SurahName != "0" & Filters.VerseNumber != ""){
            UrlToCatch = "/api/verse-in-surah/" + Filters.SurahName + "/" + Filters.VerseNumber
        }
        else if(Filters.SurahName != "0" & Filters.VerseNumber == ""){
            UrlToCatch = "/api/surah/" + Filters.SurahName
        }
        else if(Filters.SurahName == "0" & Filters.VerseNumber != ""){
            UrlToCatch = "/api/verse-in-quran/" + Filters.VerseNumber
        }
        httpGet(UrlToCatch,function(res){
            ShowResults(res);
            document.getElementsByClassName("SearchBar")[0].classList.remove("Loading");
            document.getElementById("txtSearch").removeAttribute("disabled");
            ShowMessage("با موفقیت انجام شد")
        })
        
    }
    function IsFilterOpen(){
        if(document.getElementById("divFilterContainer").classList.contains("hide"))
            return false
        return true
    }
    function toggleFilter(){
        if(IsFilterOpen()){
            document.getElementById("divFilterContainer").classList.add("hide");
            return
        }
        document.getElementById("divFilterContainer").classList.remove("hide");
    }
    function ShowMessage(txt,type){
        alert(txt)
    }
</script>
</html>